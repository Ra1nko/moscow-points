(function(){"use strict";function R(e,r,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=r||{},n.geometry=e,n}function J(e,r,t){if(t===void 0&&(t={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!_(e[0])||!_(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return R(n,r,t)}function O(e,r){r===void 0&&(r={});var t={type:"FeatureCollection"};return r.id&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.features=e,t}function X(e,r,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:e};return R(n,r,t)}function _(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function A(e,r,t){if(e!==null)for(var n,f,u,a,s,i,o,c=0,l=0,y,g=e.type,P=g==="FeatureCollection",G=g==="Feature",ye=P?e.features.length:1,w=0;w<ye;w++){o=P?e.features[w].geometry:G?e.geometry:e,y=o?o.type==="GeometryCollection":!1,s=y?o.geometries.length:1;for(var N=0;N<s;N++){var h=0,E=0;if(a=y?o.geometries[N]:o,a!==null){i=a.coordinates;var m=a.type;switch(c=t&&(m==="Polygon"||m==="MultiPolygon")?1:0,m){case null:break;case"Point":if(r(i,l,w,h,E)===!1)return!1;l++,h++;break;case"LineString":case"MultiPoint":for(n=0;n<i.length;n++){if(r(i[n],l,w,h,E)===!1)return!1;l++,m==="MultiPoint"&&h++}m==="LineString"&&h++;break;case"Polygon":case"MultiLineString":for(n=0;n<i.length;n++){for(f=0;f<i[n].length-c;f++){if(r(i[n][f],l,w,h,E)===!1)return!1;l++}m==="MultiLineString"&&h++,m==="Polygon"&&E++}m==="Polygon"&&h++;break;case"MultiPolygon":for(n=0;n<i.length;n++){for(E=0,f=0;f<i[n].length;f++){for(u=0;u<i[n][f].length-c;u++){if(r(i[n][f][u],l,w,h,E)===!1)return!1;l++}E++}h++}break;case"GeometryCollection":for(n=0;n<a.geometries.length;n++)if(A(a.geometries[n],r,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function K(e,r){if(e.type==="Feature")r(e,0);else if(e.type==="FeatureCollection")for(var t=0;t<e.features.length&&r(e.features[t],t)!==!1;t++);}function B(e,r){var t,n,f,u,a,s,i,o,c,l,y=0,g=e.type==="FeatureCollection",P=e.type==="Feature",G=g?e.features.length:1;for(t=0;t<G;t++){for(s=g?e.features[t].geometry:P?e.geometry:e,o=g?e.features[t].properties:P?e.properties:{},c=g?e.features[t].bbox:P?e.bbox:void 0,l=g?e.features[t].id:P?e.id:void 0,i=s?s.type==="GeometryCollection":!1,a=i?s.geometries.length:1,f=0;f<a;f++){if(u=i?s.geometries[f]:s,u===null){if(r(null,y,o,c,l)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(r(u,y,o,c,l)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<u.geometries.length;n++)if(r(u.geometries[n],y,o,c,l)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}y++}}function M(e){var r=[1/0,1/0,-1/0,-1/0];return A(e,function(t){r[0]>t[0]&&(r[0]=t[0]),r[1]>t[1]&&(r[1]=t[1]),r[2]<t[0]&&(r[2]=t[0]),r[3]<t[1]&&(r[3]=t[1])}),r}M.default=M;function Z(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function $(e){return e.type==="Feature"?e.geometry:e}function T(e,r,t){if(t===void 0&&(t={}),!e)throw new Error("point is required");if(!r)throw new Error("polygon is required");var n=Z(e),f=$(r),u=f.type,a=r.bbox,s=f.coordinates;if(a&&Q(n,a)===!1)return!1;u==="Polygon"&&(s=[s]);for(var i=!1,o=0;o<s.length&&!i;o++)if(F(n,s[o][0],t.ignoreBoundary)){for(var c=!1,l=1;l<s[o].length&&!c;)F(n,s[o][l],!t.ignoreBoundary)&&(c=!0),l++;c||(i=!0)}return i}function F(e,r,t){var n=!1;r[0][0]===r[r.length-1][0]&&r[0][1]===r[r.length-1][1]&&(r=r.slice(0,r.length-1));for(var f=0,u=r.length-1;f<r.length;u=f++){var a=r[f][0],s=r[f][1],i=r[u][0],o=r[u][1],c=e[1]*(a-i)+s*(i-e[0])+o*(e[0]-a)===0&&(a-e[0])*(i-e[0])<=0&&(s-e[1])*(o-e[1])<=0;if(c)return!t;var l=s>e[1]!=o>e[1]&&e[0]<(i-a)*(e[1]-s)/(o-s)+a;l&&(n=!n)}return n}function Q(e,r){return r[0]<=e[0]&&r[1]<=e[1]&&r[2]>=e[0]&&r[3]>=e[1]}function I(e,r){var t=[];return K(e,function(n){var f=!1;if(n.geometry.type==="Point")B(r,function(a){T(n,a)&&(f=!0)}),f&&t.push(n);else if(n.geometry.type==="MultiPoint"){var u=[];B(r,function(a){A(n,function(s){T(s,a)&&(f=!0,u.push(s))})}),f&&t.push(X(u))}else throw new Error("Input geometry must be a Point or MultiPoint")}),O(t)}function x(e){return Array.isArray(e)?U(e):e&&e.bbox?U(e.bbox):[ee(),re()]}function j(e,r){r===void 0&&(r={}),e==null&&(e=1);for(var t=[],n=0;n<e;n++)t.push(J(x(r.bbox)));return O(t)}function H(){return Math.random()-.5}function ee(){return H()*360}function re(){return H()*180}function U(e){return[Math.random()*(e[2]-e[0])+e[0],Math.random()*(e[3]-e[1])+e[1]]}const S=async(e,r)=>{if(e<=0)return[];const t=j(e,{bbox:M(r)}),n=I(t,r);if(n.features.length){const f=n.features.reduce((a,s)=>{const{geometry:{coordinates:[i,o]}}=s;return a.push([o,i]),a},[]),u=await S(e-n.features.length,r);return[...f,...u]}return S(e,r)},V=Symbol("Comlink.proxy"),te=Symbol("Comlink.endpoint"),ne=Symbol("Comlink.releaseProxy"),C=Symbol("Comlink.thrown"),q=e=>typeof e=="object"&&e!==null||typeof e=="function",ae={canHandle:e=>q(e)&&e[V],serialize(e){const{port1:r,port2:t}=new MessageChannel;return p(e,r),[t,[t]]},deserialize(e){return e.start(),fe(e)}},ie={canHandle:e=>q(e)&&C in e,serialize({value:e}){let r;return e instanceof Error?r={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:r={isError:!1,value:e},[r,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},z=new Map([["proxy",ae],["throw",ie]]);function p(e,r=self){r.addEventListener("message",function t(n){if(!n||!n.data)return;const{id:f,type:u,path:a}=Object.assign({path:[]},n.data),s=(n.data.argumentList||[]).map(d);let i;try{const o=a.slice(0,-1).reduce((l,y)=>l[y],e),c=a.reduce((l,y)=>l[y],e);switch(u){case"GET":i=c;break;case"SET":o[a.slice(-1)[0]]=d(n.data.value),i=!0;break;case"APPLY":i=c.apply(o,s);break;case"CONSTRUCT":{const l=new c(...s);i=le(l)}break;case"ENDPOINT":{const{port1:l,port2:y}=new MessageChannel;p(e,y),i=ue(l,[l])}break;case"RELEASE":i=void 0;break;default:return}}catch(o){i={value:o,[C]:0}}Promise.resolve(i).catch(o=>({value:o,[C]:0})).then(o=>{const[c,l]=k(o);r.postMessage(Object.assign(Object.assign({},c),{id:f}),l),u==="RELEASE"&&(r.removeEventListener("message",t),D(r))})}),r.start&&r.start()}function se(e){return e.constructor.name==="MessagePort"}function D(e){se(e)&&e.close()}function fe(e,r){return L(e,[],r)}function v(e){if(e)throw new Error("Proxy has been released and is not useable")}function L(e,r=[],t=function(){}){let n=!1;const f=new Proxy(t,{get(u,a){if(v(n),a===ne)return()=>b(e,{type:"RELEASE",path:r.map(s=>s.toString())}).then(()=>{D(e),n=!0});if(a==="then"){if(r.length===0)return{then:()=>f};const s=b(e,{type:"GET",path:r.map(i=>i.toString())}).then(d);return s.then.bind(s)}return L(e,[...r,a])},set(u,a,s){v(n);const[i,o]=k(s);return b(e,{type:"SET",path:[...r,a].map(c=>c.toString()),value:i},o).then(d)},apply(u,a,s){v(n);const i=r[r.length-1];if(i===te)return b(e,{type:"ENDPOINT"}).then(d);if(i==="bind")return L(e,r.slice(0,-1));const[o,c]=W(s);return b(e,{type:"APPLY",path:r.map(l=>l.toString()),argumentList:o},c).then(d)},construct(u,a){v(n);const[s,i]=W(a);return b(e,{type:"CONSTRUCT",path:r.map(o=>o.toString()),argumentList:s},i).then(d)}});return f}function oe(e){return Array.prototype.concat.apply([],e)}function W(e){const r=e.map(k);return[r.map(t=>t[0]),oe(r.map(t=>t[1]))]}const Y=new WeakMap;function ue(e,r){return Y.set(e,r),e}function le(e){return Object.assign(e,{[V]:!0})}function k(e){for(const[r,t]of z)if(t.canHandle(e)){const[n,f]=t.serialize(e);return[{type:"HANDLER",name:r,value:n},f]}return[{type:"RAW",value:e},Y.get(e)||[]]}function d(e){switch(e.type){case"HANDLER":return z.get(e.name).deserialize(e.value);case"RAW":return e.value}}function b(e,r,t){return new Promise(n=>{const f=ce();e.addEventListener("message",function u(a){!a.data||!a.data.id||a.data.id!==f||(e.removeEventListener("message",u),n(a.data))}),e.start&&e.start(),e.postMessage(Object.assign({id:f},r),t)})}function ce(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}p({generatePointsInPoly:S},self)})();
